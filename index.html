<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>오늘의 자기기록</title>
    <style>
        /* 폰트 및 기본 설정 */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');

        :root {
            --primary-color: #6a7ba2; /* 주요 색상: 네이비 */
            --secondary-color: #7ec8e3; /* 보조 색상: 스카이블루 */
            --background-color: #f8f8fa; /* 배경색 */
            --card-background: #FFFFFF;
            --text-color: #333;
            --border-color: #ddd;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 900px; /* 전체 너비 확장 */
            margin: 40px auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        /* 폼 섹션 스타일 */
        #record-form {
            background-color: var(--card-background);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px var(--shadow-color);
            margin-bottom: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary-color);
            font-size: 1.1em;
        }

        input[type="text"], select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Noto Sans KR', sans-serif;
            box-sizing: border-box;
        }
        
        .hint {
            font-size: 0.8rem;
            color: #999;
            margin-top: 5px;
        }

        /* 기분 선택 버튼 스타일 */
        .mood-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .mood-selector input[type="radio"] {
            display: none;
        }

        .mood-selector label {
            padding: 10px 18px;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.25s ease;
            font-weight: 500;
            user-select: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .mood-selector input[type="radio"]:checked + label {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
            font-weight: 700;
            transform: scale(1.05);
        }

        button[type="submit"] {
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button[type="submit"]:hover {
            background-color: #55668c;
        }

        /* 📝 기록 목록 섹션 (표 스타일) */
        .records-section {
            background-color: var(--card-background);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px var(--shadow-color);
        }
        
        .records-section h2 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            font-size: 1.5em;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        #export-excel {
            padding: 8px 15px;
            background-color: var(--secondary-color);
            color: var(--text-color);
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        /* 표 그리드 레이아웃 */
        .records-header, .record-row {
            display: grid;
            /* ⭐ 수정: Timestamp(100px) 컬럼 추가 */
            /* Timestamp/닉네임/점수/기분/단어/요약/칭찬/도움 */
            grid-template-columns: 100px 70px 40px 60px 100px 1fr 1fr 1fr; 
            gap: 5px;
            padding: 10px 5px;
            align-items: center;
            font-size: 0.85rem;
        }

        .records-header {
            font-weight: 700;
            background-color: #f0f0ff; /* 헤더 배경색 */
            border-bottom: 2px solid var(--primary-color);
            border-top: 2px solid var(--primary-color);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .record-row {
            border-bottom: 1px dashed var(--border-color);
        }

        .record-row:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .record-row:hover {
            background-color: #eef2f9;
        }

        .records-header > div, .record-row > div {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding: 0 5px;
        }
        
        /* 닉네임, 점수, 기분은 중앙 정렬 */
        .record-row .record-nickname,
        .record-row .record-score,
        .record-row .record-mood {
            text-align: center;
        }

        .record-row .record-mood {
            font-size: 1.2rem;
        }


        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            font-size: 0.9rem;
            color: #757575;
        }

        /* 모바일 반응형 (표를 카드로 변환) */
        @media (max-width: 600px) {
            .records-header {
                display: none;
            }
            .record-row {
                grid-template-columns: 1fr;
                gap: 5px;
                margin-bottom: 15px;
                padding: 15px;
                border: 1px solid var(--border-color);
                border-radius: 10px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            }
            .record-row > div {
                white-space: normal;
                padding: 0;
            }
            .record-row > div::before {
                content: attr(data-label) ": ";
                font-weight: bold;
                color: var(--primary-color);
                margin-right: 5px;
            }
            .record-summary, .record-praise, .record-helpful {
                /* 긴 텍스트는 폰트 크기를 조금 줄여 가독성 확보 */
                font-size: 0.9rem;
            }
            /* 모바일에서 버튼이 겹치지 않도록 */
            .section-header {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>나의 하루 리포트</h1>
            <p>오늘의 나를 객관적·감정적으로 기록해보세요.</p>
        </header>

        <main>
            <form id="record-form">
                <div class="form-group">
                    <label for="score">1️⃣ 오늘의 나의 칭찬 점수는?</label>
                    <select id="score" name="score" required>
                        <option value="">점수를 선택하세요</option>
                        </select>
                </div>

                <div class="form-group">
                    <label>2️⃣ 오늘의 나의 기분은?</label>
                    <div class="mood-selector">
                        <input type="radio" id="mood1" name="mood" value="편안" checked/>
                        <label for="mood1">😌 편안</label>

                        <input type="radio" id="mood2" name="mood" value="기쁨" />
                        <label for="mood2">☺️ 기쁨</label>

                        <input type="radio" id="mood3" name="mood" value="보통" />
                        <label for="mood3">🫤 보통</label>

                        <input type="radio" id="mood4" name="mood" value="화남" />
                        <label for="mood4">😤 화남</label>

                        <input type="radio" id="mood5" name="mood" value="슬픔" />
                        <label for="mood5">😢 슬픔</label>
                    </div>
                    <p class="hint">※ 점수(1번)는 ‘이성적 평가’, 기분은 ‘감정적 상태’를 표현합니다.</p>
                </div>

                <div class="form-group">
                    <label for="word">3️⃣ 오늘 하루를 나타내는 단어 하나</label>
                    <input
                        type="text"
                        id="word"
                        name="word"
                        maxlength="20"
                        placeholder="예: 차분함, 성취감, 지침"
                        required
                    />
                </div>

                <div class="form-group">
                    <label for="summary">4️⃣ 오늘 나에 대한 한 줄 요약</label>
                    <input
                        type="text"
                        id="summary"
                        name="summary"
                        maxlength="30"
                        placeholder="예: 오늘도 괜찮았어"
                        required
                    />
                </div>

                <div class="form-group">
                    <label for="praise">5️⃣ 오늘의 나에게 해주고 싶은 칭찬과 격려 한마디</label>
                    <textarea
                        id="praise"
                        name="praise"
                        rows="3"
                        placeholder="오늘 내가 잘한 점은 ___이다."
                    ></textarea>
                </div>

                <div class="form-group">
                    <label for="helpful">6️⃣ 나에게 도움이 되었던 행동이나 생각이 있다면 공유해 주세요</label>
                    <textarea
                        id="helpful"
                        name="helpful"
                        rows="3"
                        placeholder="예: 산책하면서 머리가 맑아졌어요."
                    ></textarea>
                </div>

                <div class="form-group">
                    <label for="nickname">7️⃣ 닉네임을 입력해주세요</label>
                    <input
                        type="text"
                        id="nickname"
                        name="nickname"
                        maxlength="10"
                        placeholder="예: 익명의 학생"
                        required
                    />
                </div>

                <button type="submit">기록하기</button>
            </form>

            <section class="records-section">
                <div class="section-header">
                    <h2>우리의 기록들</h2>
                    <button id="export-excel">엑셀로 내보내기</button>
                </div>
                <div class="records-list-container">
                    <div class="records-header">
                        <div>시간</div> <div>닉네임</div>
                        <div>점수</div>
                        <div>기분</div>
                        <div>단어</div>
                        <div>요약</div>
                        <div>칭찬/격려</div>
                        <div>도움된점</div>
                    </div>
                    <div id="records-container">
                        </div>
                </div>
            </section>

        </main>

        <footer>
            <p>&copy; 2025 나의 하루 리포트. All rights reserved.</p>
        </footer>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // [완료] 1단계: 점수 옵션을 동적으로 생성합니다.
            const scoreSelect = document.getElementById('score');
            for (let i = 10; i <= 100; i += 10) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `${i}점`;
                scoreSelect.appendChild(option);
            }

            // =================================================================
            // [추가] 2단계: 구글 시트 연동을 위한 코드
            // =================================================================

            // !!! 중요: 2단계에서 복사한 본인의 Google Apps Script 웹 앱 URL로 변경하세요.
            const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxZjbhoN6di6nyJpBs-Hk7c4-kh_x0LGgUhnkdYGq-wsG2P1vdW790XuP-ZETtr6BYV/exec'; 

            const recordForm = document.getElementById('record-form');
            const recordsContainer = document.getElementById('records-container');
            const exportButton = document.getElementById('export-excel');
            let recordsCache = []; // 데이터를 빠르게 표시하기 위한 캐시

            /**
             * 구글 시트에서 모든 기록을 불러와 화면에 표시합니다.
             */
            const loadRecords = async () => {
                recordsContainer.innerHTML = '<p>데이터를 불러오는 중...</p>';
                try {
                    const response = await fetch(WEB_APP_URL);
                    if (!response.ok) throw new Error(`HTTP 오류! 상태: ${response.status}`);
                    
                    recordsCache = await response.json();
                    
                    if (!Array.isArray(recordsCache)) {
                         throw new Error('데이터 형식이 올바르지 않습니다. Apps Script를 확인하세요.');
                    }
                    
                    // 최신 기록이 위로 오도록 Timestamp 기준으로 정렬합니다.
                    recordsCache.sort((a, b) => new Date(b.Timestamp) - new Date(a.Timestamp));

                    recordsContainer.innerHTML = ''; // '로딩 중' 메시지 제거
                    if (recordsCache.length === 0) {
                        recordsContainer.innerHTML = '<p>아직 기록이 없습니다.</p>';
                    } else {
                        recordsCache.forEach(addRecordToDOM);
                    }

                } catch (error) {
                    console.error('기록 로딩 오류:', error);
                    recordsContainer.innerHTML = `<p style="color: red;">데이터 로딩에 실패했습니다. 웹 앱 URL과 시트 설정을 확인해주세요.</p>`;
                }
            };

            /**
             * 하나의 기록 데이터를 받아 DOM 요소로 만들어 화면에 추가합니다.
             */
            const addRecordToDOM = (record) => {
                const row = document.createElement('div');
                row.classList.add('record-row');

                const moodEmojis = { '편안': '😌', '기쁨': '☺️', '보통': '🫤', '화남': '😤', '슬픔': '😢' };
                const submissionTime = new Date(record.Timestamp).toLocaleString('ko-KR', {
                    year: 'numeric', month: '2-digit', day: '2-digit',
                    hour: '2-digit', minute: '2-digit'
                });

                // data-label 속성은 모바일 뷰에서 사용됩니다.
                row.innerHTML = `
                    <div data-label="시간">${submissionTime}</div>
                    <div data-label="닉네임" class="record-nickname">${record.Nickname}</div>
                    <div data-label="점수" class="record-score">${record.Score}점</div>
                    <div data-label="기분" class="record-mood">${moodEmojis[record.Mood] || record.Mood}</div>
                    <div data-label="단어" title="${record.Word}">${record.Word}</div>
                    <div data-label="요약" title="${record.Summary}">${record.Summary}</div>
                    <div data-label="칭찬/격려" title="${record.Praise}">${record.Praise}</div>
                    <div data-label="도움된점" title="${record.Helpful}">${record.Helpful}</div>
                `;
                recordsContainer.appendChild(row);
            };

            /**
             * 폼 제출 이벤트를 처리합니다.
             */
            recordForm.addEventListener('submit', async (e) => {
                e.preventDefault(); // 폼의 기본 제출 동작(새로고침)을 막습니다.

                const submitButton = e.target.querySelector('button[type="submit"]');
                submitButton.disabled = true;
                submitButton.textContent = '저장 중...';
                
                // 폼 데이터를 객체로 만듭니다.
                const formData = new FormData(recordForm);
                const data = {
                    score: formData.get('score'),
                    mood: formData.get('mood'),
                    word: formData.get('word'),
                    summary: formData.get('summary'),
                    praise: formData.get('praise'),
                    helpful: formData.get('helpful'),
                    nickname: formData.get('nickname')
                };

                try {
                    // 구글 앱스 스크립트로 데이터 전송
                    const response = await fetch(WEB_APP_URL, {
                        method: 'POST',
                        body: JSON.stringify(data),
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    // 응답을 JSON으로 파싱
                    const result = await response.json();

                    if(result.result !== "success") {
                       throw new Error(result.message || '알 수 없는 오류가 발생했습니다.');
                    }
                    
                    alert('성공적으로 기록되었습니다!');
                    recordForm.reset();
                    loadRecords(); // 목록을 새로고침합니다.

                } catch (error) {
                    console.error('기록 제출 오류:', error);
                    alert(`기록 저장에 실패했습니다: ${error.message}`);
                } finally {
                    submitButton.disabled = false;
                    submitButton.textContent = '기록하기';
                }
            });

            // 초기 데이터 로드
            loadRecords();
        });
    </script>

</body>
</html>