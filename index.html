<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì˜¤ëŠ˜ì˜ ìê¸°ê¸°ë¡</title>
    <style>
        /* í°íŠ¸ ë° ê¸°ë³¸ ì„¤ì • */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');

        :root {
            --primary-color: #6a7ba2; /* ì£¼ìš” ìƒ‰ìƒ: ë„¤ì´ë¹„ */
            --secondary-color: #7ec8e3; /* ë³´ì¡° ìƒ‰ìƒ: ìŠ¤ì¹´ì´ë¸”ë£¨ */
            --background-color: #f8f8fa; /* ë°°ê²½ìƒ‰ */
            --card-background: #FFFFFF;
            --text-color: #333;
            --border-color: #ddd;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 900px; /* ì „ì²´ ë„ˆë¹„ í™•ì¥ */
            margin: 40px auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        /* í¼ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        #record-form {
            background-color: var(--card-background);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px var(--shadow-color);
            margin-bottom: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary-color);
            font-size: 1.1em;
        }

        input[type="text"], select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Noto Sans KR', sans-serif;
            box-sizing: border-box;
        }
        
        .hint {
            font-size: 0.8rem;
            color: #999;
            margin-top: 5px;
        }

        /* ê¸°ë¶„ ì„ íƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .mood-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .mood-selector input[type="radio"] {
            display: none;
        }

        .mood-selector label {
            padding: 10px 18px;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.25s ease;
            font-weight: 500;
            user-select: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .mood-selector input[type="radio"]:checked + label {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
            font-weight: 700;
            transform: scale(1.05);
        }

        button[type="submit"] {
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button[type="submit"]:hover {
            background-color: #55668c;
        }

        /* ğŸ“ ê¸°ë¡ ëª©ë¡ ì„¹ì…˜ (í‘œ ìŠ¤íƒ€ì¼) */
        .records-section {
            background-color: var(--card-background);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px var(--shadow-color);
        }
        
        .records-section h2 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            font-size: 1.5em;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        #export-excel {
            padding: 8px 15px;
            background-color: var(--secondary-color);
            color: var(--text-color);
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        /* í‘œ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
        .records-header, .record-row {
            display: grid;
            /* â­ ìˆ˜ì •: Timestamp(100px) ì»¬ëŸ¼ ì¶”ê°€ */
            /* Timestamp/ë‹‰ë„¤ì„/ì ìˆ˜/ê¸°ë¶„/ë‹¨ì–´/ìš”ì•½/ì¹­ì°¬/ë„ì›€ */
            grid-template-columns: 100px 70px 40px 60px 100px 1fr 1fr 1fr; 
            gap: 5px;
            padding: 10px 5px;
            align-items: center;
            font-size: 0.85rem;
        }

        .records-header {
            font-weight: 700;
            background-color: #f0f0ff; /* í—¤ë” ë°°ê²½ìƒ‰ */
            border-bottom: 2px solid var(--primary-color);
            border-top: 2px solid var(--primary-color);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .record-row {
            border-bottom: 1px dashed var(--border-color);
        }

        .record-row:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .record-row:hover {
            background-color: #eef2f9;
        }

        .records-header > div, .record-row > div {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding: 0 5px;
        }
        
        /* ë‹‰ë„¤ì„, ì ìˆ˜, ê¸°ë¶„ì€ ì¤‘ì•™ ì •ë ¬ */
        .record-row .record-nickname,
        .record-row .record-score,
        .record-row .record-mood {
            text-align: center;
        }

        .record-row .record-mood {
            font-size: 1.2rem;
        }


        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            font-size: 0.9rem;
            color: #757575;
        }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• (í‘œë¥¼ ì¹´ë“œë¡œ ë³€í™˜) */
        @media (max-width: 600px) {
            .records-header {
                display: none;
            }
            .record-row {
                grid-template-columns: 1fr;
                gap: 5px;
                margin-bottom: 15px;
                padding: 15px;
                border: 1px solid var(--border-color);
                border-radius: 10px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            }
            .record-row > div {
                white-space: normal;
                padding: 0;
            }
            .record-row > div::before {
                content: attr(data-label) ": ";
                font-weight: bold;
                color: var(--primary-color);
                margin-right: 5px;
            }
            .record-summary, .record-praise, .record-helpful {
                /* ê¸´ í…ìŠ¤íŠ¸ëŠ” í°íŠ¸ í¬ê¸°ë¥¼ ì¡°ê¸ˆ ì¤„ì—¬ ê°€ë…ì„± í™•ë³´ */
                font-size: 0.9rem;
            }
            /* ëª¨ë°”ì¼ì—ì„œ ë²„íŠ¼ì´ ê²¹ì¹˜ì§€ ì•Šë„ë¡ */
            .section-header {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ë‚˜ì˜ í•˜ë£¨ ë¦¬í¬íŠ¸</h1>
            <p>ì˜¤ëŠ˜ì˜ ë‚˜ë¥¼ ê°ê´€ì Â·ê°ì •ì ìœ¼ë¡œ ê¸°ë¡í•´ë³´ì„¸ìš”.</p>
        </header>

        <main>
            <form id="record-form">
                <div class="form-group">
                    <label for="score">1ï¸âƒ£ ì˜¤ëŠ˜ì˜ ë‚˜ì˜ ì¹­ì°¬ ì ìˆ˜ëŠ”?</label>
                    <select id="score" name="score" required>
                        <option value="">ì ìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                </div>

                <div class="form-group">
                    <label>2ï¸âƒ£ ì˜¤ëŠ˜ì˜ ë‚˜ì˜ ê¸°ë¶„ì€?</label>
                    <div class="mood-selector">
                        <input type="radio" id="mood1" name="mood" value="í¸ì•ˆ" checked/>
                        <label for="mood1">ğŸ˜Œ í¸ì•ˆ</label>

                        <input type="radio" id="mood2" name="mood" value="ê¸°ì¨" />
                        <label for="mood2">â˜ºï¸ ê¸°ì¨</label>

                        <input type="radio" id="mood3" name="mood" value="ë³´í†µ" />
                        <label for="mood3">ğŸ«¤ ë³´í†µ</label>

                        <input type="radio" id="mood4" name="mood" value="í™”ë‚¨" />
                        <label for="mood4">ğŸ˜¤ í™”ë‚¨</label>

                        <input type="radio" id="mood5" name="mood" value="ìŠ¬í””" />
                        <label for="mood5">ğŸ˜¢ ìŠ¬í””</label>
                    </div>
                    <p class="hint">â€» ì ìˆ˜(1ë²ˆ)ëŠ” â€˜ì´ì„±ì  í‰ê°€â€™, ê¸°ë¶„ì€ â€˜ê°ì •ì  ìƒíƒœâ€™ë¥¼ í‘œí˜„í•©ë‹ˆë‹¤.</p>
                </div>

                <div class="form-group">
                    <label for="word">3ï¸âƒ£ ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë‹¨ì–´ í•˜ë‚˜</label>
                    <input
                        type="text"
                        id="word"
                        name="word"
                        maxlength="20"
                        placeholder="ì˜ˆ: ì°¨ë¶„í•¨, ì„±ì·¨ê°, ì§€ì¹¨"
                        required
                    />
                </div>

                <div class="form-group">
                    <label for="summary">4ï¸âƒ£ ì˜¤ëŠ˜ ë‚˜ì— ëŒ€í•œ í•œ ì¤„ ìš”ì•½</label>
                    <input
                        type="text"
                        id="summary"
                        name="summary"
                        maxlength="30"
                        placeholder="ì˜ˆ: ì˜¤ëŠ˜ë„ ê´œì°®ì•˜ì–´"
                        required
                    />
                </div>

                <div class="form-group">
                    <label for="praise">5ï¸âƒ£ ì˜¤ëŠ˜ì˜ ë‚˜ì—ê²Œ í•´ì£¼ê³  ì‹¶ì€ ì¹­ì°¬ê³¼ ê²©ë ¤ í•œë§ˆë””</label>
                    <textarea
                        id="praise"
                        name="praise"
                        rows="3"
                        placeholder="ì˜¤ëŠ˜ ë‚´ê°€ ì˜í•œ ì ì€ ___ì´ë‹¤."
                    ></textarea>
                </div>

                <div class="form-group">
                    <label for="helpful">6ï¸âƒ£ ë‚˜ì—ê²Œ ë„ì›€ì´ ë˜ì—ˆë˜ í–‰ë™ì´ë‚˜ ìƒê°ì´ ìˆë‹¤ë©´ ê³µìœ í•´ ì£¼ì„¸ìš”</label>
                    <textarea
                        id="helpful"
                        name="helpful"
                        rows="3"
                        placeholder="ì˜ˆ: ì‚°ì±…í•˜ë©´ì„œ ë¨¸ë¦¬ê°€ ë§‘ì•„ì¡Œì–´ìš”."
                    ></textarea>
                </div>

                <div class="form-group">
                    <label for="nickname">7ï¸âƒ£ ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</label>
                    <input
                        type="text"
                        id="nickname"
                        name="nickname"
                        maxlength="10"
                        placeholder="ì˜ˆ: ìµëª…ì˜ í•™ìƒ"
                        required
                    />
                </div>

                <button type="submit">ê¸°ë¡í•˜ê¸°</button>
            </form>

            <section class="records-section">
                <div class="section-header">
                    <h2>ìš°ë¦¬ì˜ ê¸°ë¡ë“¤</h2>
                    <button id="export-excel">ì—‘ì…€ë¡œ ë‚´ë³´ë‚´ê¸°</button>
                </div>
                <div class="records-list-container">
                    <div class="records-header">
                        <div>ì‹œê°„</div> <div>ë‹‰ë„¤ì„</div>
                        <div>ì ìˆ˜</div>
                        <div>ê¸°ë¶„</div>
                        <div>ë‹¨ì–´</div>
                        <div>ìš”ì•½</div>
                        <div>ì¹­ì°¬/ê²©ë ¤</div>
                        <div>ë„ì›€ëœì </div>
                    </div>
                    <div id="records-container">
                        </div>
                </div>
            </section>

        </main>

        <footer>
            <p>&copy; 2025 ë‚˜ì˜ í•˜ë£¨ ë¦¬í¬íŠ¸. All rights reserved.</p>
        </footer>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // [ì™„ë£Œ] 1ë‹¨ê³„: ì ìˆ˜ ì˜µì…˜ì„ ë™ì ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.
            const scoreSelect = document.getElementById('score');
            for (let i = 10; i <= 100; i += 10) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `${i}ì `;
                scoreSelect.appendChild(option);
            }

            // =================================================================
            // [ì¶”ê°€] 2ë‹¨ê³„: êµ¬ê¸€ ì‹œíŠ¸ ì—°ë™ì„ ìœ„í•œ ì½”ë“œ
            // =================================================================

            // !!! ì¤‘ìš”: 2ë‹¨ê³„ì—ì„œ ë³µì‚¬í•œ ë³¸ì¸ì˜ Google Apps Script ì›¹ ì•± URLë¡œ ë³€ê²½í•˜ì„¸ìš”.
            const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxZjbhoN6di6nyJpBs-Hk7c4-kh_x0LGgUhnkdYGq-wsG2P1vdW790XuP-ZETtr6BYV/exec'; 

            const recordForm = document.getElementById('record-form');
            const recordsContainer = document.getElementById('records-container');
            const exportButton = document.getElementById('export-excel');
            let recordsCache = []; // ë°ì´í„°ë¥¼ ë¹ ë¥´ê²Œ í‘œì‹œí•˜ê¸° ìœ„í•œ ìºì‹œ

            /**
             * êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ëª¨ë“  ê¸°ë¡ì„ ë¶ˆëŸ¬ì™€ í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
             */
            const loadRecords = async () => {
                recordsContainer.innerHTML = '<p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
                try {
                    const response = await fetch(WEB_APP_URL);
                    if (!response.ok) throw new Error(`HTTP ì˜¤ë¥˜! ìƒíƒœ: ${response.status}`);
                    
                    recordsCache = await response.json();
                    
                    if (!Array.isArray(recordsCache)) {
                         throw new Error('ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. Apps Scriptë¥¼ í™•ì¸í•˜ì„¸ìš”.');
                    }
                    
                    // ìµœì‹  ê¸°ë¡ì´ ìœ„ë¡œ ì˜¤ë„ë¡ Timestamp ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•©ë‹ˆë‹¤.
                    recordsCache.sort((a, b) => new Date(b.Timestamp) - new Date(a.Timestamp));

                    recordsContainer.innerHTML = ''; // 'ë¡œë”© ì¤‘' ë©”ì‹œì§€ ì œê±°
                    if (recordsCache.length === 0) {
                        recordsContainer.innerHTML = '<p>ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    } else {
                        recordsCache.forEach(addRecordToDOM);
                    }

                } catch (error) {
                    console.error('ê¸°ë¡ ë¡œë”© ì˜¤ë¥˜:', error);
                    recordsContainer.innerHTML = `<p style="color: red;">ë°ì´í„° ë¡œë”©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì›¹ ì•± URLê³¼ ì‹œíŠ¸ ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</p>`;
                }
            };

            /**
             * í•˜ë‚˜ì˜ ê¸°ë¡ ë°ì´í„°ë¥¼ ë°›ì•„ DOM ìš”ì†Œë¡œ ë§Œë“¤ì–´ í™”ë©´ì— ì¶”ê°€í•©ë‹ˆë‹¤.
             */
            const addRecordToDOM = (record) => {
                const row = document.createElement('div');
                row.classList.add('record-row');

                const moodEmojis = { 'í¸ì•ˆ': 'ğŸ˜Œ', 'ê¸°ì¨': 'â˜ºï¸', 'ë³´í†µ': 'ğŸ«¤', 'í™”ë‚¨': 'ğŸ˜¤', 'ìŠ¬í””': 'ğŸ˜¢' };
                const submissionTime = new Date(record.Timestamp).toLocaleString('ko-KR', {
                    year: 'numeric', month: '2-digit', day: '2-digit',
                    hour: '2-digit', minute: '2-digit'
                });

                // data-label ì†ì„±ì€ ëª¨ë°”ì¼ ë·°ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.
                row.innerHTML = `
                    <div data-label="ì‹œê°„">${submissionTime}</div>
                    <div data-label="ë‹‰ë„¤ì„" class="record-nickname">${record.Nickname}</div>
                    <div data-label="ì ìˆ˜" class="record-score">${record.Score}ì </div>
                    <div data-label="ê¸°ë¶„" class="record-mood">${moodEmojis[record.Mood] || record.Mood}</div>
                    <div data-label="ë‹¨ì–´" title="${record.Word}">${record.Word}</div>
                    <div data-label="ìš”ì•½" title="${record.Summary}">${record.Summary}</div>
                    <div data-label="ì¹­ì°¬/ê²©ë ¤" title="${record.Praise}">${record.Praise}</div>
                    <div data-label="ë„ì›€ëœì " title="${record.Helpful}">${record.Helpful}</div>
                `;
                recordsContainer.appendChild(row);
            };

            /**
             * í¼ ì œì¶œ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
             */
            recordForm.addEventListener('submit', async (e) => {
                e.preventDefault(); // í¼ì˜ ê¸°ë³¸ ì œì¶œ ë™ì‘(ìƒˆë¡œê³ ì¹¨)ì„ ë§‰ìŠµë‹ˆë‹¤.

                const submitButton = e.target.querySelector('button[type="submit"]');
                submitButton.disabled = true;
                submitButton.textContent = 'ì €ì¥ ì¤‘...';
                
                // í¼ ë°ì´í„°ë¥¼ ê°ì²´ë¡œ ë§Œë“­ë‹ˆë‹¤.
                const formData = new FormData(recordForm);
                const data = {
                    score: formData.get('score'),
                    mood: formData.get('mood'),
                    word: formData.get('word'),
                    summary: formData.get('summary'),
                    praise: formData.get('praise'),
                    helpful: formData.get('helpful'),
                    nickname: formData.get('nickname')
                };

                try {
                    // êµ¬ê¸€ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ë¡œ ë°ì´í„° ì „ì†¡
                    const response = await fetch(WEB_APP_URL, {
                        method: 'POST',
                        body: JSON.stringify(data),
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    // ì‘ë‹µì„ JSONìœ¼ë¡œ íŒŒì‹±
                    const result = await response.json();

                    if(result.result !== "success") {
                       throw new Error(result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                    
                    alert('ì„±ê³µì ìœ¼ë¡œ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    recordForm.reset();
                    loadRecords(); // ëª©ë¡ì„ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.

                } catch (error) {
                    console.error('ê¸°ë¡ ì œì¶œ ì˜¤ë¥˜:', error);
                    alert(`ê¸°ë¡ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                } finally {
                    submitButton.disabled = false;
                    submitButton.textContent = 'ê¸°ë¡í•˜ê¸°';
                }
            });

            // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
            loadRecords();
        });
    </script>

</body>
</html>